<!DOCTYPE html>
<html>
<head>
    <title>My Ultimate Voice Assistant</title>
    <style>
        :root {
            --primary: #4361ee;
            --danger: #f72585;
            --success: #4cc9f0;
            --warning: #f8961e;
            --info: #4895ef;
            --background: #f8f9fa;
            --text: #212529;
        }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--background);
            color: var(--text);
            line-height: 1.6;
        }
        h1 {
            color: var(--primary);
            text-align: center;
            margin-bottom: 10px;
            font-weight: 700;
        }
        .subtitle {
            text-align: center;
            color: #6c757d;
            margin-bottom: 25px;
            font-size: 1em;
        }
        #chatbox {
            height: 400px;
            border: 1px solid #dee2e6;
            padding: 15px;
            overflow-y: auto;
            margin-bottom: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .message {
            padding: 12px 16px;
            border-radius: 18px;
            margin: 12px 0;
            max-width: 85%;
            word-wrap: break-word;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            line-height: 1.5;
            animation: fadeIn 0.3s ease;
            opacity: 0.95;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 0.95; transform: translateY(0); }
        }
        .user-message {
            background: var(--primary);
            color: white;
            margin-left: auto;
            border-radius: 18px 18px 0 18px;
        }
        .bot-message {
            background: #e9ecef;
            border-radius: 18px 18px 18px 0;
        }
        .system-message {
            background: #f8f9fa;
            margin: 12px auto;
            max-width: 90%;
            text-align: center;
            font-style: italic;
            color: #6c757d;
            border-left: 4px solid var(--info);
            font-size: 0.9em;
        }
        .input-group {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }
        #userInput {
            flex: 1;
            padding: 14px 18px;
            border: 1px solid #ced4da;
            border-radius: 24px;
            font-size: 16px;
            background: white;
            transition: all 0.2s;
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.05);
        }
        #userInput:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }
        button {
            padding: 14px 22px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 24px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.2s;
            font-weight: 500;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button:hover {
            filter: brightness(1.1);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        button:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        #micButton {
            background: var(--danger);
            width: 56px;
            height: 56px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            border-radius: 50%;
        }
        #micButton.listening {
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(247, 37, 133, 0.7); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(247, 37, 133, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(247, 37, 133, 0); }
        }
        .control-panel {
            background: white;
            padding: 20px;
            border-radius: 14px;
            margin-top: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .panel-title {
            font-weight: 600;
            color: var(--primary);
            font-size: 1.1em;
        }
        .toggle-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 12px 0;
            padding: 8px 0;
        }
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 52px;
            height: 30px;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ced4da;
            transition: .4s;
            border-radius: 34px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: var(--success);
        }
        input:checked + .slider:before {
            transform: translateX(22px);
        }
        .command-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #e9ecef;
        }
        .command-item:last-child {
            border-bottom: none;
        }
        .command-text {
            flex: 1;
            padding-right: 10px;
        }
        .command-trigger {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 4px;
        }
        .command-desc {
            color: #6c757d;
            font-size: 0.9em;
        }
        .command-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .command-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: #6c757d;
            font-size: 18px;
            padding: 6px;
            transition: all 0.2s;
            border-radius: 50%;
        }
        .command-btn:hover {
            color: var(--primary);
            background: rgba(67, 97, 238, 0.1);
        }
        #status {
            height: 20px;
            margin-top: 8px;
            color: #6c757d;
            font-size: 14px;
            text-align: center;
            font-style: italic;
        }
        #addCommandPanel {
            display: none;
            background: white;
            padding: 20px;
            border-radius: 14px;
            margin-top: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border: 1px solid #dee2e6;
        }
        .add-command-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        .form-group label {
            font-weight: 500;
            color: #495057;
        }
        .add-command-form input,
        .add-command-form textarea {
            padding: 12px;
            border: 1px solid #ced4da;
            border-radius: 8px;
            font-size: 15px;
            transition: all 0.2s;
        }
        .add-command-form input:focus,
        .add-command-form textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }
        .add-command-form textarea {
            min-height: 80px;
            resize: vertical;
        }
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 15px;
        }
        .secondary-btn {
            background: #e9ecef;
            color: #495057;
        }
        .success-btn {
            background: var(--success);
        }
        .command-example {
            font-size: 0.8em;
            color: #6c757d;
            margin-top: 4px;
        }
        #ideasPanel {
            display: none;
            background: white;
            padding: 20px;
            border-radius: 14px;
            margin-top: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .command-idea {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 12px;
            border-left: 4px solid var(--warning);
        }
        .idea-trigger {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 6px;
        }
        .idea-response {
            color: #495057;
            font-style: italic;
            margin-bottom: 10px;
            padding-left: 10px;
            border-left: 2px solid #dee2e6;
        }
        .command-idea button {
            padding: 8px 12px;
            font-size: 14px;
            background: var(--success);
        }
    </style>
</head>
<body>
    <h1>My Ultimate Voice Assistant</h1>
    <p class="subtitle">Speak naturally or type commands - I'm ready to help!</p>
    
    <div id="chatbox"></div>
    
    <div class="input-group">
        <input type="text" id="userInput" placeholder="Type your message or say 'Hey Assistant'..." autofocus>
        <button onclick="sendMessage()">Send</button>
        <button id="micButton" onclick="toggleSpeechRecognition()">🎤</button>
    </div>
    
    <div id="status"></div>
    
    <div class="control-panel">
        <div class="panel-header">
            <div class="panel-title">Voice Settings</div>
        </div>
        <div class="toggle-container">
            <span>Enable Voice Responses</span>
            <label class="toggle-switch">
                <input type="checkbox" id="speechToggle" checked>
                <span class="slider"></span>
            </label>
        </div>
        <div class="toggle-container">
            <span>Only Speak for Commands</span>
            <label class="toggle-switch">
                <input type="checkbox" id="onlySpeakForCommands">
                <span class="slider"></span>
            </label>
        </div>
    </div>
    
    <div class="control-panel">
        <div class="panel-header">
            <div class="panel-title">Command Center</div>
        </div>
        <button onclick="showAddCommandPanel()" style="width:100%;margin-bottom:12px;background:var(--info)">
            <span style="font-size:1.2em">+</span> Add Custom Command
        </button>
        <button onclick="toggleCommandsPanel()" style="width:100%">
            <span style="font-size:1.1em">📋</span> View All Commands
        </button>
        <button onclick="toggleIdeasPanel()" style="width:100%;margin-top:12px;background:var(--warning);color:var(--text)">
            💡 Get Command Ideas
        </button>
    </div>
    
    <div class="control-panel" id="commandsPanel" style="display:none">
        <div class="panel-header">
            <div class="panel-title">My Command Library</div>
            <button onclick="toggleCommandsPanel()" style="background:transparent;color:var(--primary);padding:0;font-size:1.1em">✕ Close</button>
        </div>
        <div id="commandsList"></div>
    </div>

    <div id="addCommandPanel">
        <div class="panel-header">
            <div class="panel-title">Create New Command</div>
            <button onclick="hideAddCommandPanel()" style="background:transparent;color:var(--primary);padding:0;font-size:1.1em">✕</button>
        </div>
        <div class="add-command-form">
            <div class="form-group">
                <label>Trigger Phrases</label>
                <input type="text" id="newCommandTriggers" placeholder="e.g., 'lights on, illuminate, turn on lights'">
                <div class="command-example">Separate multiple triggers with commas</div>
            </div>
            <div class="form-group">
                <label>Assistant's Response</label>
                <textarea id="newCommandResponse" placeholder="What should I say when triggered?"></textarea>
                <div class="command-example">Example: 'Turning on the lights now!'</div>
            </div>
            <div class="form-group">
                <label>Description (for help menu)</label>
                <input type="text" id="newCommandDesc" placeholder="e.g., 'Controls the living room lights'">
                <div class="command-example">This helps you remember what the command does</div>
            </div>
            <div class="form-actions">
                <button onclick="hideAddCommandPanel()" class="secondary-btn">Cancel</button>
                <button onclick="saveNewCommand()" class="success-btn">Save Command</button>
            </div>
        </div>
    </div>

    <div class="control-panel" id="ideasPanel" style="display:none">
        <div class="panel-header">
            <div class="panel-title">Command Ideas</div>
            <button onclick="toggleIdeasPanel()" style="background:transparent;color:var(--primary);padding:0">✕</button>
        </div>
        <div class="command-idea">
            <div class="idea-trigger">"weather, what's the weather"</div>
            <div class="idea-response">"Currently sunny and 72°F in your area"</div>
            <button onclick="useIdea('weather, what\'s the weather', 'Currently sunny and 72°F in your area', 'Provides weather information')">Use This</button>
        </div>
        <div class="command-idea">
            <div class="idea-trigger">"joke, tell me a joke"</div>
            <div class="idea-response">"Why don't scientists trust atoms? Because they make up everything!"</div>
            <button onclick="useIdea('joke, tell me a joke', 'Why don\'t scientists trust atoms? Because they make up everything!', 'Tells a funny joke')">Use This</button>
        </div>
        <div class="command-idea">
            <div class="idea-trigger">"remind me to [task], remember [task]"</div>
            <div class="idea-response">"I'll remind you to [task] later"</div>
            <button onclick="useIdea('remind me to, remember', 'I\'ll remind you to [task] later', 'Sets reminders')">Use This</button>
        </div>
        <div class="command-idea">
            <div class="idea-trigger">"calculate [equation], what's [equation]"</div>
            <div class="idea-response">"The answer to [equation] is [result]"</div>
            <button onclick="useIdea('calculate, what\'s', 'The answer to [equation] is [result]', 'Does simple math calculations')">Use This</button>
        </div>
    </div>

    <script>
        // ======================
        // CORE SETUP
        // ======================
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const recognition = new SpeechRecognition();
        recognition.continuous = false;
        recognition.interimResults = false;
        recognition.lang = 'en-US';

        const synth = window.speechSynthesis;
        let currentUtterance = null;
        let isListening = false;
        let lastBotResponse = "";
        let lastSpeechTime = 0;
        const speechDelay = 2000; // 2 seconds between speeches

        // DOM elements
        const micButton = document.getElementById('micButton');
        const statusElement = document.getElementById('status');
        const commandsPanel = document.getElementById('commandsPanel');
        const commandsList = document.getElementById('commandsList');
        const addCommandPanel = document.getElementById('addCommandPanel');
        const ideasPanel = document.getElementById('ideasPanel');

        // Load commands from localStorage
        let customCommands = JSON.parse(localStorage.getItem('customCommands')) || [
            {
                triggers: ["help", "commands", "what can you do"],
                action: "showAvailableCommands()",
                description: "Show all available commands"
            },
            {
                triggers: ["clear", "clear chat", "clean screen"],
                action: "clearChat()",
                description: "Clear the conversation history"
            },
            {
                triggers: ["stop", "stop speaking", "quiet"],
                action: "stopSpeaking()",
                description: "Stop the assistant from speaking"
            },
            {
                triggers: ["repeat", "say again", "what did you say"],
                action: "speakLastResponse()",
                description: "Repeat the last response"
            },
            {
                triggers: ["time", "what time is it", "current time"],
                action: "respondToQuery('The current time is ' + new Date().toLocaleTimeString())",
                description: "Get the current time"
            },
            {
                triggers: ["date", "what's today's date", "current date"],
                action: "respondToQuery('Today is ' + new Date().toLocaleDateString())",
                description: "Get today's date"
            },
            {
                triggers: ["hey assistant", "wake up", "attention"],
                action: "respondToQuery('Hello! How can I help you today?')",
                description: "Get the assistant's attention"
            }
        ];

        // ======================
        // COMMAND SYSTEM
        // ======================
        function checkForCustomCommand(message, isSystemMessage = false) {
            if (isSystemMessage || !message.trim()) return false;
            
            const lowerMsg = message.toLowerCase();
            if (lowerMsg.startsWith("assistant:")) return false;
            
            for (const command of customCommands) {
                for (const trigger of command.triggers) {
                    if (lowerMsg.includes(trigger.toLowerCase())) {
                        displayMessage(`Recognized command: "${trigger}"`, 'system');
                        try {
                            if (typeof command.action === 'string') {
                                eval(command.action);
                            } else if (typeof command.action === 'function') {
                                command.action();
                            }
                            return true;
                        } catch (e) {
                            console.error("Command error:", e);
                            respondToQuery("Hmm, I had trouble with that command. Let's try something else.", true);
                            return true;
                        }
                    }
                }
            }
            return false;
        }

        function showAvailableCommands() {
            updateCommandsList();
            commandsPanel.style.display = 'block';
            respondToQuery("Here are all the commands I understand:", true);
        }

        function toggleCommandsPanel() {
            commandsPanel.style.display = commandsPanel.style.display === 'none' ? 'block' : 'none';
            if (commandsPanel.style.display === 'block') updateCommandsList();
        }

        function toggleIdeasPanel() {
            ideasPanel.style.display = ideasPanel.style.display === 'none' ? 'block' : 'none';
            if (ideasPanel.style.display === 'block') {
                commandsPanel.style.display = 'none';
                addCommandPanel.style.display = 'none';
            }
        }

        function showAddCommandPanel() {
            addCommandPanel.style.display = 'block';
            commandsPanel.style.display = 'none';
            ideasPanel.style.display = 'none';
            document.getElementById('newCommandTriggers').focus();
        }

        function hideAddCommandPanel() {
            addCommandPanel.style.display = 'none';
            document.getElementById('newCommandTriggers').value = '';
            document.getElementById('newCommandResponse').value = '';
            document.getElementById('newCommandDesc').value = '';
        }

        function useIdea(triggers, response, description) {
            document.getElementById('newCommandTriggers').value = triggers;
            document.getElementById('newCommandResponse').value = response;
            document.getElementById('newCommandDesc').value = description;
            toggleIdeasPanel();
            showAddCommandPanel();
        }

        function updateCommandsList() {
            commandsList.innerHTML = customCommands.map((cmd, index) => `
                <div class="command-item">
                    <div class="command-text">
                        <div class="command-trigger">"${cmd.triggers[0]}"</div>
                        <div class="command-desc">${cmd.description}</div>
                    </div>
                    <div class="command-actions">
                        <button class="command-btn" onclick="deleteCommand(${index})" title="Delete">✕</button>
                    </div>
                </div>
            `).join('');
        }

        function deleteCommand(index) {
            if (confirm(`Delete the command "${customCommands[index].triggers[0]}"?`)) {
                customCommands.splice(index, 1);
                saveCommandsToStorage();
                updateCommandsList();
                respondToQuery("Command deleted successfully.", true);
            }
        }

        function saveNewCommand() {
            const triggers = document.getElementById('newCommandTriggers').value.trim();
            const response = document.getElementById('newCommandResponse').value.trim();
            const description = document.getElementById('newCommandDesc').value.trim();

            if (!triggers || !response || !description) {
                alert("Please fill in all fields to create a command");
                return;
            }

            const triggerList = triggers.split(',').map(t => t.trim()).filter(t => t);
            
            customCommands.push({
                triggers: triggerList,
                action: `respondToQuery("${response.replace(/"/g, '\\"')}")`,
                description: description
            });

            saveCommandsToStorage();
            hideAddCommandPanel();
            updateCommandsList();
            respondToQuery(`Success! I'll now respond to "${triggerList[0]}" with "${response}"`, true);
        }

        function saveCommandsToStorage() {
            localStorage.setItem('customCommands', JSON.stringify(customCommands));
        }

        function clearChat() {
            document.getElementById('chatbox').innerHTML = '';
            respondToQuery("Chat history cleared. How can I help you now?");
        }

        // ======================
        // CORE CHAT FUNCTIONS
        // ======================
        function toggleSpeechRecognition() {
            if (isListening) {
                recognition.stop();
                micButton.classList.remove('listening');
                statusElement.textContent = "";
                isListening = false;
            } else {
                recognition.start();
                micButton.classList.add('listening');
                statusElement.textContent = "Listening... Speak now";
                isListening = true;
            }
        }

        recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript;
            document.getElementById('userInput').value = transcript;
            sendMessage();
        };

        recognition.onerror = (event) => {
            statusElement.textContent = `Error: ${event.error}`;
            micButton.classList.remove('listening');
            isListening = false;
        };

        recognition.onend = () => {
            if (isListening) recognition.start();
            else {
                micButton.classList.remove('listening');
                statusElement.textContent = "";
            }
        };

        function sendMessage() {
            const userInput = document.getElementById('userInput');
            const message = userInput.value.trim();
            
            if (!message) return;
            
            displayMessage(message, 'user');
            
            setTimeout(() => {
                if (!checkForCustomCommand(message)) {
                    const response = generateResponse(message);
                    respondToQuery(response);
                }
            }, 500);
            
            userInput.value = '';
            userInput.focus();
        }

        function generateResponse(message) {
            const lowerMsg = message.toLowerCase();
            
            if (lowerMsg.includes('hello') || lowerMsg.includes('hi') || lowerMsg.includes('hey')) {
                return randomChoice([
                    "Hello there! What can I do for you today?",
                    "Hi! I'm ready to help. Try asking about the time or date.",
                    "Greetings! You can teach me new commands using the 'Add Command' button."
                ]);
            }
            
            if (lowerMsg.includes('bye') || lowerMsg.includes('goodbye')) {
                return randomChoice([
                    "Goodbye! Your custom commands will be here when you return.",
                    "See you later! Don't forget you can add more commands anytime.",
                    "Farewell! I'm always learning, so teach me more when you come back."
                ]);
            }
            
            return randomChoice([
                "I'm not sure how to respond to that. You can teach me by adding a custom command!",
                "Interesting! You can create a custom response for that using the 'Add Command' button.",
                "I'm still learning. Would you like to teach me how to respond to that?"
            ]);
        }

        function respondToQuery(response, isSystemMessage = false) {
            lastBotResponse = response;
            displayMessage(response, isSystemMessage ? 'system' : 'bot');
            
            if (!isSystemMessage && shouldSpeak()) {
                speak(response);
            }
        }

        function shouldSpeak() {
            return document.getElementById('speechToggle').checked &&
                  (!document.getElementById('onlySpeakForCommands').checked || 
                   lastBotResponse.includes("Recognized command:"));
        }

        function displayMessage(message, sender) {
            const chatbox = document.getElementById('chatbox');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            
            if (sender === 'user') {
                messageDiv.textContent = message;
            } else if (sender === 'system') {
                messageDiv.textContent = `System: ${message}`;
            } else if (sender === 'bot') {
                messageDiv.textContent = `Assistant: ${message}`;
            }
            
            chatbox.appendChild(messageDiv);
            chatbox.scrollTop = chatbox.scrollHeight;
        }

        function speak(text) {
            const now = Date.now();
            if (now - lastSpeechTime < speechDelay) return;
            lastSpeechTime = now;
            
            if (synth.speaking) synth.cancel();
            
            currentUtterance = new SpeechSynthesisUtterance(text);
            currentUtterance.voice = getPreferredVoice();
            currentUtterance.pitch = 1;
            currentUtterance.rate = 1;
            
            synth.speak(currentUtterance);
        }

        function getPreferredVoice() {
            const voices = synth.getVoices();
            const preferredVoices = [
                'Google UK English Female',
                'Microsoft Zira - English (United States)',
                'Samantha'
            ];
            
            for (const voiceName of preferredVoices) {
                const voice = voices.find(v => v.name === voiceName);
                if (voice) return voice;
            }
            
            return voices.find(v => v.lang.includes('en')) || voices[0];
        }

        function speakLastResponse() {
            if (lastBotResponse && document.getElementById('speechToggle').checked) {
                speak(lastBotResponse);
            }
        }

        function stopSpeaking() {
            synth.cancel();
        }

        function randomChoice(array) {
            return array[Math.floor(Math.random() * array.length)];
        }

        // ======================
        // INITIALIZATION
        // ======================
        if (speechSynthesis.onvoiceschanged !== undefined) {
            speechSynthesis.onvoiceschanged = getPreferredVoice;
        }

        document.getElementById('userInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });

        window.addEventListener('load', () => {
            setTimeout(() => {
                respondToQuery("Hello! I'm your personal voice assistant. Try saying 'Hey Assistant' or ask about the time. You can also add custom commands!");
            }, 800);
        });
    </script>
</body>
</html>
